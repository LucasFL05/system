<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>salvar</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
<h1>Spring Boot REST API</h1>

<form action="" id="formRegisterUser">
    <div class="mb-3">
        <label for="id" class="form-label">ID</label>
        <input type="text" class="form-control" id="id" readonly="readonly">
    </div>

    <div class="mb-3">
            <label for="name" class="name">NAME:</label>
        <input type="text" class="form-control" id="name" placeholder="enter the name">
    </div>

    <div class="mb-3">
        <label for="age" class="form-label">AGE:</label>
        <input type="number" class="form-control" id="age" placeholder="enter the age">
    </div>
</form>

<button type="button" class="btn btn-success" id="btnSaveUser" onclick="saveUser()">Save</button>
<button type="button" class="btn btn-primary" onclick="document.getElementById('formRegisterUser').reset();">New</button>
<button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#search" data-bs-whatever="@mdo">search</button>


<div class="modal fade" id="search" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">search user</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="recipient-name" class="col-form-label" >Name:</label>
                        <input type="text" class="form-control" id="recipient-name">
                    </div>
                </form>
                <table class="table table-striped table-hover" id="tableResults">
                    <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Age</th>
                        <th scope="col">Edit</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>

                    </tr>
                    <tr>

                    </tr>
                    <tr>

                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="searchUserName()">Search</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script type="text/javascript">

    function searchUserName() {
        var user = {
            name: $("#recipient-name").val()
        };

        if (user.name == "") {
            alert("Enter the name to search");
            return;
    }

    $.ajax({
        type: "GET",
        url: "api/users/searchName",
        data: { name: user.name },
        success: function (response) {

            $("#tableResults > tbody > tr").remove();

            for (var i = 0; i < response.length; i++) {
                var user = response[i];
                var row = "<tr><td>" + user.id + "</td><td>" + user.name + "</td><td>" + user.age + "</td><td><button type='button' class='btn btn-primary' data-bs-dismiss='modal' onclick='searchUserId(" + user.id + ")'>Edit</button></td></tr>";
                $("#tableResults > tbody").append(row);
            }

         },
        error: function (e) {
            alert("Error when searching for user");
        }
    });
}

    function searchUserId(id) {

    $.ajax({
        type: "GET",
        url: "api/users/" + id,
        success: function (response) {
            $("#id").val(response.id);
            $("#name").val(response.name);
            $("#age").val(response.age);
        },
        error: function (e) {
            alert("Error when searching for user");
        }
    });
}

    function editUser(id) {
    var user = {
        id: id,
        name: $("#name").val(),
        age: $("#age").val()
    };

    $.ajax({
        type: "PUT",
        url: "api/users/" + id,
        contentType: "application/json",
        data: JSON.stringify(user),
        success: function (data) {
            alert("User updated successfully");
        },
        error: function (e) {
            alert("Error updating user");
        }
    });
}


    function saveUser(event) {
    var user = {
        id: $("#id").val(),
        name: $("#name").val(),
        age: $("#age").val()
    };

    if (user.name == "") {
            alert("Enter the name to save");
            return;
    }

    $.ajax({
        type: "POST",
        url: "api/users",
        contentType: "application/json",
        data: JSON.stringify(user),
        success: function (data) {
            alert("User saved successfully");
            $("#formRegisterUser")[0].reset(); // Limpa o formul√°rio
        },
        error: function (e) {
            alert("Error saving user");
        }
    });
}

</script>


</body>
</html>